/**
 * [手机号/固定电话/银行卡/普通数字卡号/身份证/姓名/用户名/电子邮箱]隐私保护遮挡
 * 自动匹配字符串模式类型
 * 		手机号码:	{{'13563368008' | strCover:"{format:true,hidden:true}"}}		--> 136 **** 8008
 * 		手机号码:	{{'13563368008' | strCover:"{format:true,hidden:false}"}}		--> 136 6336 8008
 * 		手机号码:	{{'13563368008' | strCover:"{format:false,hidden:true}"}}		--> 136****8008
 * 		手机号码:	{{'13563368008' | strCover:"{format:false,hidden:false}"}}		--> 13663368008
 * 		16位银行卡:	{{'6226431780096555' | strCover:"{format:true,hidden:true}"}}	--> 6226 **** **** 6555
 * 		19位银行卡:	{{'6226431780096555001' | strCover:"{format:true,hidden:true}"}}--> 6226 **** **** **** 001
 * @author Liutaowei 46134256@qq.com
 * @date   2016-09-27T13:53:38+0800
 * @version 1.1.1
 * @param  {str} str 要匹配的字符串
 * @param  {json} obj 配制
 *                  hidden:是否隐藏
 *                  format:是否格式化
 * @return 输出匹配字串
 */
define(["./module"],function(a){a.filter("strCover",function(){return function(d,b){var c={init:function(){if(!d){return"--"}this._str=d;this.str=this._str.toString().replace(/\s/ig,"");this.oType=this.macthType(this.str,this.patten);this.isFormat=this.strToJson.format=="true"||!!parseInt(this.strToJson.format)?true:false;this.isHidden=this.strToJson.hidden=="true"||!!parseInt(this.strToJson.hidden)?true:false;return this.opStrFn(this.oType)},patten:{mobile:/^(((\+\d{1,4})|(0))?1\s*[3|4|5|7|8|9]\s*\d\s*)(\d{4}\s*)(\d{4}\s*)$/i,telephone:/^((((\+86)|0)?[1-9]{2,4}[-])?)([^0^1]\d{1})(\d{3,4})(\d{2})(([-\s]\d{3,4})?)$/,email:/^([\w-\.]+)((@[\w\-]+)(.[\-\w]+){0,2}(.[a-z]{2,5}))$/ig,idNo_:/^((11|12|13|14|15|21|22|23|31|32|33|34|35|36|37|41|42|43|44|45|46|50|51|52|53|54|61|62|63|64|65|71|81|82)\d{4})(((19)|(20))\d{2}([0][1-9]|[1][02])([0][1-9]|[12][0-9]|[3][01])\d)(\d{2}[\d|x])$/i,bankCard:/^(35|37|40|41|42|43|45|47|48|49|51|52|53|54|55|60|62|64|91|95|99)(\d{14}|\d{17})$/i,otherCard:/^(\d{5,35})$/i,},strToJson:JSON.parse(b.toString().replace(/['"]?(\w+)['"]?/ig,'"$1"')),macthType:function(f,e){for(var f in e){if(e[f].test(this.str)==true){return f}}return"default"},strHiddenFn:function(k,l,h){if(!this.isHidden){return k}var n=k.split(""),e=n.length,f=Math.round(e*0.26),j=e-f*2,h=h?h:"*",m="";for(var g=0;g<e;g++){m+=(!!l||l==1)?h:((g>=f&&g<f+j)?h:n[g])}return m},nameFn:function(t,j,p,r){var f=/[\u4e00-\u9fa5]/ig,m=/(((\s*[A-Za-z])|[A-Z])[a-z0-9]*)/g,h="",o=this,g=f.test(t)?"CN":"EN",s=p<=0||isNaN(p)?0:p,r=!!parseInt(r)?parseInt(r):1;switch(g){case"EN":var l=t.match(m),n=l.length,j=j?j:"*";angular.forEach(l,function(x,y){console.log("--------:nameEn:"+t+"("+x+")--------");if(r==1){h+=o.strHiddenFn(l[y],0,j)}else{if(s==0&&y==0){h+=l[y]}else{var w=o.strHiddenFn(l[y],0,j);h+=o.isFormat?" "+w:w}}});break;case"CN":default:var u=t.match(f),e=u.length-1,q=this.isFormat?" ":"",j=j?j:"×";for(var k=0;k<e;k++){console.log("--------:nameCn:"+t+"("+u[k]+")--------");q+=o.isHidden?j:u[k]}h+=q+u[e];h=o.isFormat?" "+h:h}return h},opStrFn:function(g){var i=this;var j="";switch(g){case"mobile":console.log("--------:mobile:"+this.str+"--------");j=this.str.replace(this.patten.mobile,"$1,$5,$6").split(",");j[1]=this.isFormat?" "+this.strHiddenFn(j[1],1)+" ":this.strHiddenFn(j[1],1);this.result=j.toString().replace(/,/g,"");break;case"telephone":console.log("--------:telephone:"+this.str+"--------");j=this.str.replace(this.patten.telephone,"$1,$4,$5,$6,$7").split(",");this.result=j[0]+j[2]+this.strHiddenFn(j[3],1)+j[4];break;case"bankCard":console.log("--------:bankCard:"+this.str+"--------");var f=/\d{1,4}/ig;case"otherCard":console.log("--------:otherCard:"+this.str+"--------");var h=f||/\d{1,3}/ig,m=this.str.match(h),k=m.length;if(k>3){var n="";angular.forEach(m,function(o,p){switch(p){case 0:case k-1:n+=o;break;default:n+=i.isFormat==true?" "+i.strHiddenFn(o,1)+" ":i.strHiddenFn(o,1)}});this.result=n}else{this.result=this.strHiddenFn(this.str,0)}break;case"email":console.log("--------:email:"+this.str+"--------");j=this.str.replace(this.patten.email,"$1,$2").split(",");this.result=(this.isHidden?this.strHiddenFn(j[0]):j[0])+j[1];break;case"idNo_":console.log("--------:idNo_:"+this.str+"--------");j=this.str.replace(this.patten.idNo_,"$1,$3,$9").split(",");this.result=j[0]+this.strHiddenFn(j[1],1)+j[2];break;case"normal":default:var l=/(([\u4e00-\u9fa5]+\d*)|([A-Z]([a-z]*\d*))|([a-z]([a-z]*\d*)\s*))/g,e=this._str.replace("s+"," ").match(l);i.result="";angular.forEach(e,function(o,p){i.result+=i.nameFn(o,false,p,e.length)})}return this.result}};return c.init()}})});
